# 一. 模块开发顺序

## 1 系统支撑与全局约定

### （1）统一返回结构与异常处理

接口文档要求所有接口必须返回固定结构 code message data，且 code 仅 0 表示成功，字段名不能改。
需求分析也明确要求定义统一 Result<T> 与全局异常处理，并约定常见业务错误码。

### （2）ID 序列化策略

接口文档要求所有长整型主键对外统一序列化为字符串，覆盖用户、商品、分类、购物车、订单等。
需求分析再次强调该规则用于避免前端精度丢失。

### （3）认证与权限基础设施

接口文档规定 token 由登录后返回，前端通过 Authorization Bearer 方式携带，缺失或非法统一返回 40002。
需求分析要求区分用户与管理员角色，对后台接口做权限控制，并区分管理员与普通用户的访问范围。

### （4）文件上传与静态资源映射

上传接口 POST /api/upload 是头像与商品图片链路的前置能力。
接口文档与需求分析都强调“先上传文件、再在业务接口提交图片 URL”的模式，以及本地静态资源目录映射。

## 2 基础数据域

### （1）分类

项目业务固定两级分类结构。需求分析对前台与后台均强调该约束。
分类是商品的前置依赖，因此建议优先完成分类实体、表结构、后台分类管理接口与前台分类树接口。

### （2）商品

商品列表与详情是前台的核心入口，且依赖分类。需求分析给出分类分页、关键字搜索、排序、详情多图等范围。
同时后台商品 CRUD 与上下架也依赖同一套商品模型。

## 3 用户端核心交易链路

按依赖关系由浅入深。

（1）账户与认证
前台注册、登录、退出、获取当前用户信息是所有需要登录接口的入口。
接口层面也已明确对应路径与行为。

（2）购物车
购物车依赖商品库存校验与价格展示，接口要求修改数量时必须校验库存并在成功后返回最新汇总信息。
接口文档也提供了对应的返回形态。

（3）收货地址
地址是下单的前置输入，需支持默认地址逻辑。

（4）订单与支付结果模拟
订单是系统关键闭环，依赖商品库存、购物车与地址，并要求
在事务中完成校验库存、扣减库存、生成订单与明细
从购物车下单成功后自动删除对应购物车记录
保存地址快照信息
支持超时自动取消并回滚库存。
支付结果模拟用于将订单状态闭环打通，需禁止对超时已取消订单重复支付。

创建订单相关操作必须放在同一事务中。

推荐顺序为
订单创建与列表详情
取消订单
支付模拟
超时自动取消任务

## 4 管理后台模块

后台本质上复用前面沉淀的领域模型与鉴权框架。

（1）管理员登录
与前台登录类似，角色区分即可。

（2）后台商品管理

（3）后台分类管理

（4）后台订单管理与发货状态变更
需求分析对后台订单的演示诉求比较明确。

这样安排能保证每完成一段功能就能形成可演示的阶段性成果
先能登录并看商品分类与列表
再能加购与维护地址
最后打通下单、支付、超时取消
后台接口随时可用 Postman 验证。

# 二 技术栈及开发工具软件

## 1 技术栈

（1）Java 与 Spring Boot 生态
用于快速构建 REST 接口与分层结构，匹配接口文档 REST JSON 统一约定。

（2）Spring MVC
处理 Controller 路由、参数绑定、文件上传 MultipartFile。

（3）MySQL
作为核心业务持久化数据库
用户、分类、商品、购物车、订单、订单明细、地址等建议均落库。

（4）MyBatis-Plus
满足项目当前技术路线与快速 CRUD 需求。

如需复杂 SQL 可配合原生 MyBatis 写法。

（5）Redis

Redis 可选，用于登录态或缓存

（6）JWT
用于生成与解析 token
与接口文档固定的 Bearer 规范匹配。

（7）BCrypt
用于密码加密存储。

（8）Bean Validation
用于参数校验并映射 40001 错误码。

（9）BigDecimal
用于金额计算及对外返回数值类型约束。

（10）定时任务组件
用于订单超时自动取消
使用 Spring 的定时任务能力满足需求。

（11）日志框架
在登录、下单、支付、超时取消、后台商品与订单变更等关键点记录日志。

## 2 开发工具与软件

（1）JDK
 JDK-21，与目前Spring Boot 版本兼容

（2）IDE
IntelliJ IDEA 

（3）数据库工具
Navicat 

（4）接口调试工具
 Apifox

（5）构建与依赖管理
Maven

（6）版本管理
Git

（7）本地静态资源与图片调试
按文档约定，将图片保存到本地 static 目录，并通过 Spring MVC 映射为可访问路径

（8）前后端联调辅助
前端开发环境采用 Vite 代理优先解决跨域
后端可在需要本地直连调试时补充 CORS。
生产环境以网关或后端 CORS 为主

# 三. 完整目录与文件清单

```java
jd-online-mall
└─ src
   └─ main
      ├─ java
      │  └─ com
      │     └─ tq
      │        ├─ JdOnlineMallApplication.java   
      │        │   
      │        ├─ common   
      │        │  ├─ api   
      │        │  │  ├─ Result.java   
      │        │  │  ├─ PageResult.java   
      │        │  │  └─ ErrorCode.java   
      │        │  ├─ exception   
      │        │  │  ├─ BusinessException.java   
      │        │  │  ├─ NotFoundException.java
      │        │  │  ├─ ForbiddenException.java
      │        │  │  └─ UnauthorizedException.java   
      │        │  ├─ handler   
      │        │  │  └─ GlobalExceptionHandler.java   
      │        │  ├─ constant   
      │        │  │  ├─ AuthConstant.java   
      │        │  │  └─ RedisKeyConstant.java   
      │        │  ├─ enums   
      │        │  │  ├─ RoleEnum.java   
      │        │  │  ├─ OrderStatusEnum.java   
      │        │  │  └─ CancelReasonEnum.java   
      │        │  └─ util   
      │        │     ├─ JwtUtil.java   
      │        │     ├─ PasswordUtil.java   
      │        │     ├─ IdUtil.java
      │        │     ├─ UrlUtil.java   
      │        │     └─ TimeUtil.java   
      │        │   
      │        ├─ config
      │        │  ├─ JdMallPropertiesConfig.java
      │        │  ├─ JacksonConfig.java
      │        │  ├─ WebMvcConfig.java
      │        │  ├─ MybatisPlusConfig.java
      │        │  ├─ CorsConfig.java
      │        │  ├─ TaskConfig.java
      │        │  ├─ PasswordConfig.java
      │        │  └─ properties
      │        │     ├─ AuthTokenProperties.java
      │        │     ├─ JwtProperties.java
      │        │     ├─ UploadProperties.java
      │        │     ├─ OrderTimeoutProperties.java
      │        │     └─ CorsProperties.java
      │        │
      │        ├─ security   
      │        │  ├─ token   
      │        │  │  ├─ TokenService.java   
      │        │  │  └─ JwtTokenService.java   
      │        │  ├─ interceptor   
      │        │  │  ├─ AuthInterceptor.java   
      │        │  │  └─ AdminInterceptor.java   
      │        │  └─ context   
      │        │     └─ UserContext.java   
      │        │   
      │        ├─ module   
      │        │  ├─ auth   
      │        │  │  ├─ controller   
      │        │  │  │  ├─ AuthController.java   
      │        │  │  │  └─ AdminAuthController.java   
      │        │  │  ├─ dto   
      │        │  │  │  ├─ LoginRequest.java   
      │        │  │  │  ├─ RegisterRequest.java   
      │        │  │  │  ├─ LoginResponse.java
      │        │  │  │  └─ RegisterResponse.java
      │        │  │  ├─ entity   
      │        │  │  │  └─ User.java   
      │        │  │  ├─ mapper   
      │        │  │  │  └─ UserMapper.java   
      │        │  │  └─ service   
      │        │  │     ├─ AuthService.java   
      │        │  │     └─ impl   
      │        │  │        └─ AuthServiceImpl.java   
      │        │  │   
      │        │  ├─ category   
      │        │  │  ├─ controller   
      │        │  │  │  ├─ CategoryController.java   
      │        │  │  │  └─ AdminCategoryController.java   
      │        │  │  ├─ dto   
      │        │  │  │  ├─ CategoryCreateRequest.java   
      │        │  │  │  ├─ CategoryUpdateRequest.java   
      │        │  │  │  └─ CategoryTreeNode.java   
      │        │  │  ├─ entity   
      │        │  │  │  └─ Category.java   
      │        │  │  ├─ mapper   
      │        │  │  │  └─ CategoryMapper.java   
      │        │  │  └─ service   
      │        │  │     ├─ CategoryService.java   
      │        │  │     └─ impl   
      │        │  │        └─ CategoryServiceImpl.java   
      │        │  │   
      │        │  ├─ product   
      │        │  │  ├─ controller   
      │        │  │  │  ├─ ProductController.java   
      │        │  │  │  └─ AdminProductController.java   
      │        │  │  ├─ dto   
      │        │  │  │  ├─ ProductQueryRequest.java   
      │        │  │  │  ├─ ProductCreateRequest.java   
      │        │  │  │  ├─ ProductUpdateRequest.java   
      │        │  │  │  └─ ProductDetailVO.java   
      │        │  │  ├─ entity   
      │        │  │  │  └─ Product.java   
      │        │  │  ├─ mapper   
      │        │  │  │  └─ ProductMapper.java   
      │        │  │  └─ service   
      │        │  │     ├─ ProductService.java   
      │        │  │     └─ impl   
      │        │  │        └─ ProductServiceImpl.java   
      │        │  │   
      │        │  ├─ cart   
      │        │  │  ├─ controller   
      │        │  │  │  └─ CartController.java   
      │        │  │  ├─ dto   
      │        │  │  │  ├─ CartAddRequest.java   
      │        │  │  │  ├─ CartUpdateRequest.java   
      │        │  │  │  ├─ CartVO.java
      │        │  │  │  ├─ CarBatchDeleteRequest.java
      │        │  │  │  └─ CartItemVO.java  
      │        │  │  ├─ entity   
      │        │  │  │  └─ CartItem.java   
      │        │  │  ├─ mapper   
      │        │  │  │  └─ CartItemMapper.java   
      │        │  │  └─ service   
      │        │  │     ├─ CartService.java   
      │        │  │     └─ impl   
      │        │  │        └─ CartServiceImpl.java   
      │        │  │   
      │        │  ├─ address   
      │        │  │  ├─ controller   
      │        │  │  │  └─ AddressController.java   
      │        │  │  ├─ dto   
      │        │  │  │  ├─ AddressCreateRequest.java   
      │        │  │  │  ├─ AddressUpdateRequest.java   
      │        │  │  │  └─ AddressVO.java   
      │        │  │  ├─ entity   
      │        │  │  │  └─ Address.java   
      │        │  │  ├─ mapper   
      │        │  │  │  └─ AddressMapper.java   
      │        │  │  └─ service   
      │        │  │     ├─ AddressService.java   
      │        │  │     └─ impl   
      │        │  │        └─ AddressServiceImpl.java   
      │        │  │   
      │        │  ├─ order   
      │        │  │  ├─ controller   
      │        │  │  │  ├─ OrderController.java   
      │        │  │  │  └─ AdminOrderController.java   
      │        │  │  ├─ dto   
      │        │  │  │  ├─ OrderCreateRequest.java   
      │        │  │  │  ├─ OrderPayRequest.java   
      │        │  │  │  ├─ OrderStatusUpdateRequest.java   
      │        │  │  │  ├─ AdminOrderListItemVO.java   
      │        │  │  │  ├─ OrderListItemVO.java 
      │        │  │  │  └─ OrderDetailVO.java   
      │        │  │  ├─ entity   
      │        │  │  │  ├─ Order.java   
      │        │  │  │  ├─ OrderItem.java   
      │        │  │  │  └─ AddressSnapshot.java   
      │        │  │  ├─ mapper   
      │        │  │  │  ├─ OrderMapper.java   
      │        │  │  │  └─ OrderItemMapper.java   
      │        │  │  └─ service   
      │        │  │     ├─ OrderService.java   
      │        │  │     └─ impl   
      │        │  │        └─ OrderServiceImpl.java   
      │        │  │   
      │        │  └─ upload   
      │        │     ├─ controller   
      │        │     │  └─ UploadController.java   
      │        │     ├─ dto   
      │        │     │  └─ UploadResponse.java   
      │        │     └─ service   
      │        │        ├─ UploadService.java   
      │        │        └─ impl   
      │        │           └─ UploadServiceImpl.java   
      │        │   
      │        ├─ schedule   
      │        │  ├─ OrderTimeoutJob.java   
      │        │  └─ OrderTimeoutConfig.java   
      │        │   
      │        ├─ log   
      │        │  ├─ OperationLogAspect.java   
      │        │  └─ LogEventPublisher.java   
      │        │   
      │        └─ bootstrap   
      │           └─ DataInitRunner.java   
      │
      └─ resources
         ├─ application.yml
         ├─ application-dev.yml
         ├─ application-prod.yml
         ├─ mapper
         │  ├─ AddressMapper.xml
         ├─ static
         └─ logback-spring.xml
```

# 四. 包与文件职责说明

## 1 启动入口

JdOnlineMallApplication.java
Spring Boot 启动类，后续可在这里启用定时任务、扫描 Mapper 等

## 2 common 通用层

（1）common/api
Result.java
用于实现接口文档强制的 code message data 统一结构，且字段名不可修改
PageResult.java
用于对分页响应做统一封装，匹配 pageNum pageSize total list 的约定
ErrorCode.java
集中定义业务错误码，覆盖 40001 40002 40003 40004 40400 50000 等范围

（2）common/exception 与 common/handler
BusinessException 等
用于承载业务语义错误
GlobalExceptionHandler.java
将所有异常统一转换为标准 Result 结构，确保错误场景也满足接口文档返回体要求

（3）common/constant 与 common/enums
RoleEnum
支撑区分普通用户与管理员，并与 /api/admin/** 权限要求一致
OrderStatusEnum CancelReasonEnum
用于订单状态流转与区分用户取消与系统超时取消，便于后台演示

（4）common/util
JwtUtil PasswordUtil 等
将工具能力集中放置，避免散落在 Service 中

## 3 config 配置层

JacksonConfig.java
实现 Long ID 对外序列化为字符串的全局策略，覆盖用户 商品 分类 购物车 订单及明细等
同时可统一时间格式为 yyyy-MM-dd HH:mm:ss

WebMvcConfig.java
注册拦截器、静态资源映射等。
静态图片目录映射应满足上传模块要求

MybatisPlusConfig.java
分页插件、自动填充、逻辑删除策略等可预留

CorsConfig.java
开发期可不强制启用，若需要本地直连调试再开启，与文档建议一致

TaskConfig.java
统一管理定时任务线程池等基础配置

JdMallPropertiesConfig 用来集中启用并聚合 jd 前缀相关的 ConfigurationProperties 绑定入口。

JacksonConfig 负责 Long ID 序列化为字符串与统一时间格式等全局序列化策略。

WebMvcConfig 负责拦截器注册与本地上传目录到 /images 的静态资源映射。

MybatisPlusConfig 负责分页插件等 MyBatis-Plus 全局能力入口。

CorsConfig 负责读取 CorsProperties 并在需要时启用后端跨域策略。

TaskConfig 负责定时任务相关线程池或任务基础配置入口。

properties 子包中的五个 Properties 类分别绑定 jd.auth.token、jd.jwt、jd.upload、jd.order、jd.cors。

## 4 security 安全与上下文层

token
TokenService 与 JwtTokenService
抽象登录态实现，便于在 JWT 与 Redis 方案间切换，符合需求分析的可选要求

interceptor
AuthInterceptor
负责用户端通用鉴权逻辑，允许匿名接口白名单可按接口文档维护
AdminInterceptor
对 /api/admin/** 做管理员角色校验，角色不符返回 40003

context
UserContext
用于在一次请求生命周期内存储当前用户信息，减少 Service 层重复解析 token。

## 5 module 业务分域

将每个业务域按 controller dto entity mapper service 分层，这样前台与后台接口可以自然分离，且与接口前缀约定匹配

（1）auth
AuthController 负责 /api/auth/**
AdminAuthController 负责 /api/admin/auth/**
User 实体可通过 RoleEnum 区分是否管理员，符合需求分析

（2）category
同时提供前台分类树与后台分类管理
两级分类限制应在 Service 层体现

（3）product
支持前台分类浏览、关键字搜索、排序、详情多图
后台提供新增 编辑 删除 上下架，并与上传图片流程配合

（4）cart
按需求优先落库实现
CartVO 用于承载接口要求的购物车汇总信息返回

（5）address
AddressController 对应用户地址 CRUD 与默认地址逻辑

（6）order
Order 与 OrderItem 分表更利于清晰表达订单明细
AddressSnapshot 作为值对象或可嵌入对象，满足下单时地址快照要求
AdminOrderController 支持后台状态修改与备注

（7）upload
UploadController 对应 POST /api/upload。
UploadResponse 建议包含 url fullUrl originalFilename 等字段，与接口示例一致

## 6 schedule 定时任务域

OrderTimeoutJob
用于实现订单超时自动取消与库存回滚
OrderTimeoutConfig
集中管理超时时间配置，便于把 15 分钟切换为更短测试时间

## 7 log 日志域

OperationLogAspect LogEventPublisher
用于按接口文档建议记录登录、下单、支付、超时取消、后台商品与订单变更等关键操作
后续也可以只保留切面或只保留显式日志调用，结构上先预留位置即可

## 8 bootstrap 启动期数据与演示支持

DataInitRunner
用于可选的初始化演示数据，例如分类树、少量商品、管理员账号，提升联调与演示效率

## 9 resources 资源层

application.yml 与多环境配置
用于数据库、Redis、JWT 密钥、上传目录、超时参数等统一配置

mapper/*.xml
如果部分复杂查询中使用 XML，自然归档到此处

static/images
按文档建议作为本地图片保存目录，放一个 .keep 保证 Git 能跟踪空目录

logback-spring.xml
用于规划日志级别与落盘策略，便于后续演示与排查





